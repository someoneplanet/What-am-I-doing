#!/data/data/com.termux/files/usr/bin/bash

echo "Simple Shizuku ADB Wireless Setup"
echo "--------------------------------"
echo "1. Go to Settings > Developer options"
echo "2. Enable 'Wireless debugging'"
echo "3. Tap on 'Wireless debugging'"
echo "4. Tap 'Pair device with pairing code'"
echo "5. Enter the details shown on your screen below"
echo ""

read -p "Enter Wireless debugging IP (e.g., 192.168.1.100): " pairing_ip
read -p "Enter pairing port: " pairing_port
read -p "Enter pairing code: " pairing_code

# Start ADB server
adb kill-server
adb start-server

echo "Attempting to pair..."
adb pair ${pairing_ip}:${pairing_port} ${pairing_code}

echo ""
echo "Now under 'Wireless debugging', look for 'IP address & Port'"
echo ""

read -p "Enter IP address (same as before): " connect_ip
read -p "Enter port number: " connect_port

echo "Attempting to connect..."
adb connect ${connect_ip}:${connect_port}

if adb devices | grep -q "${connect_ip}:${connect_port}"; then
    echo "Successfully connected!"
    echo ""
    echo "Now:"
    echo "1. Open Shizuku app"
    echo "2. Select 'Wireless debugging (No root)'"
    echo ""
    echo "To split screen on Xiaomi:"
    echo "1. Open Recents"
    echo "2. Long press app"
    echo "3. Tap 'Split screen'"
else
    echo "Connection failed. Please check the entered details and try again."
fi

# Save reconnection command
echo "#!/data/data/com.termux/files/usr/bin/bash" > ~/shizuku_reconnect.sh
echo "adb connect ${connect_ip}:${connect_port}" >> ~/shizuku_reconnect.sh
chmod +x ~/shizuku_reconnect.sh
echo ""
echo "Created reconnection script at ~/shizuku_reconnect.sh"
